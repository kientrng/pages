<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<link rel="icon" href="avatar.png">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ch·ªën H·ªçc T·∫≠p ‚Äî KienDev_</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root{
  --neon1:#7C3AED;
  --neon2:#06B6D4;
  --muted:#95a5c7;
  --pink1:#ffb86b;
  --pink2:#ff6bcb
}
*{box-sizing:border-box}
body{margin:0;font-family:Poppins;background:#030516;color:#e7f0ff}
.wrap{max-width:1200px;margin:auto;padding:20px}

/* ===== TOP ===== */
.top{
  display:flex;flex-wrap:wrap;gap:16px;
  padding:16px;border-radius:14px;
  background:rgba(255,255,255,.02);
  border:1px solid rgba(255,255,255,.05)
}
.brand{display:flex;gap:14px;align-items:center}
.avatar{width:70px;height:70px;border-radius:14px}
.title h1{margin:0;font-size:20px}
.title p{margin:3px 0 0;font-size:13px;color:var(--muted)}

.controls{
  margin-left:auto;
  display:flex;
  align-items:center;
  gap:4px;
}
.search{
  height:42px;
  padding:0 14px;
  width:200px;
  border-radius:10px 0 0 10px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  color:white;
  font-size:13px;
}
.controls button{
  height:42px;
  padding:0 14px;
  border-radius:0 10px 10px 0;
}

/* ===== BUTTONS ===== */
button.small{
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.06);
  color:white;
  cursor:pointer
}
button.small.active{
  background:linear-gradient(90deg,var(--neon1),var(--neon2));
  font-weight:700
}

.filters{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}

/* ===== SECTIONS ===== */
.section{margin-top:18px}
.section h3{margin:0 0 8px;font-size:14px;color:var(--muted)}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:18px
}

/* ===== CARD ===== */
.card{
  padding:16px;border-radius:14px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.05);
  position:relative;transition:.2s
}
.card:hover{transform:translateY(-6px)}
.card-top{display:flex;gap:12px;align-items:center}

.file-icon{
  width:52px;height:52px;border-radius:12px;
  background:rgba(255,255,255,.06);
  display:flex;align-items:center;justify-content:center;
  font-size:26px
}
.name{font-weight:700;font-size:15px}
.sub{font-size:12px;color:var(--muted);margin-top:4px}

.card-actions{margin-top:14px;display:flex;gap:10px}
.action-btn{
  flex:1;padding:10px;border-radius:10px;
  font-weight:700;border:0;cursor:pointer;
  display:flex;align-items:center;justify-content:center;gap:6px
}
.view-btn{background:linear-gradient(90deg,#0ea5e9,#7c3aed);color:white}
.download-btn{background:linear-gradient(90deg,var(--pink1),var(--pink2));color:#071023;text-decoration:none}

.top-badge{
  position:absolute;top:14px;left:14px;
  padding:4px 8px;font-size:11px;font-weight:700;
  border-radius:6px;
  background:linear-gradient(90deg,#ffb86b,#ff6bcb);
  color:#071023
}

/* ===== RECENT SCROLL ===== */
.recent-row{display:flex;gap:16px;overflow-x:auto;padding-bottom:12px}
.recent-row .card{min-width:260px}
.recent-row::-webkit-scrollbar{height:8px}
.recent-row::-webkit-scrollbar-thumb{
  background:linear-gradient(90deg,var(--neon1),var(--neon2));
  border-radius:10px
}
  
/* FIX filter buttons */
.filters .small{
  height:36px;
  padding:0 14px;
  font-size:13px;
  line-height:36px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  border-radius:999px; /* pill cho ƒë·∫πp */
}

/* active v·∫´n gi·ªØ gradient */
.filters .small.active{
  background:linear-gradient(90deg,var(--neon1),var(--neon2));
}

/* ===== IN-APP WARNING ===== */
.inapp-warning{
  position:fixed;
  bottom:16px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(20,20,40,.95);
  border:1px solid rgba(255,255,255,.12);
  border-radius:14px;
  padding:14px 16px;
  max-width:92%;
  z-index:9999;
  display:none;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}
.inapp-warning h4{margin:0 0 6px;font-size:14px}
.inapp-warning p{margin:0 0 10px;font-size:12px;color:var(--muted)}
.inapp-warning button{
  width:100%;
  height:40px;
  border-radius:10px;
  border:0;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(90deg,var(--neon1),var(--neon2));
  color:white;
}
</style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <div class="brand">
      <img src="avatar.png" class="avatar">
      <div class="title">
        <h1>CH·ªêN H·ªåC T·∫¨P</h1>
        <p>Code by KienDev ‚Äî Xem & T·∫£i t√†i li·ªáu</p>
        <p>T√¨m theo m√£: (l·ªõp)-(s·ªë)-(m√¥n)</p>
      </div>
    </div>
    <div class="controls">
      <input id="q" class="search" placeholder="T√¨m m√£ ƒë·ªÅ...">
      <button class="small" onclick="load()">‚ü≥</button>
    </div>
  </div>

  <div class="filters">
    <button class="small active" onclick="setFilter('all',this)">T·∫•t c·∫£</button>
    <button class="small" onclick="setFilter('recent',this)">üÜï G·∫ßn ƒë√¢y</button>
    <button class="small" onclick="setFilter('old',this)">üì¶ ƒê·ªÅ c≈©</button>
    <button class="small" onclick="setFilter('10',this)">L·ªõp 10</button>
    <button class="small" onclick="setFilter('11',this)">L·ªõp 11</button>
    <button class="small" onclick="setFilter('12',this)">L·ªõp 12</button>
  </div>

  <div class="section">
    <h3>File g·∫ßn ƒë√¢y</h3>
    <div id="recent" class="recent-row"></div>
  </div>

  <div class="section">
    <h3 id="mainTitle">T·∫•t c·∫£</h3>
    <div id="grid" class="grid"></div>
  </div>

</div>

<!-- IN-APP WARNING -->
<div id="inappWarning" class="inapp-warning">
  <h4>‚ö† Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß</h4>
  <p>
    Trang ƒëang m·ªü trong TikTok / Messenger / Zalo.<br>
    M·ªôt s·ªë ch·ª©c nƒÉng nh∆∞ t·∫£i file c√≥ th·ªÉ kh√¥ng ho·∫°t ƒë·ªông.
  </p>
  <button onclick="openInBrowser()">üåê M·ªü b·∫±ng tr√¨nh duy·ªát</button>
</div>

<script>
const owner="kientrng", repo="pages", folder="files";
const api=`https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;

const grid = document.getElementById("grid");
const recent = document.getElementById("recent");
const q = document.getElementById("q");

let all=[];

/* ===== UTILS ===== */
const clean=n=>n.replace(/\.(docx?|pdf)$/i,"");
const extIcon=n=>/doc/.test(n)?"üìò":/pdf/.test(n)?"üìï":"üìÑ";

function parseFile(f){
  const base=clean(f.name);
  const p=base.split("-");
  return{
    name:f.name,
    grade:p[0]||"",
    num:p[1]||"",
    subject:p[2]||"",
    desc:p.slice(3).join("-"),
    code:p.slice(0,3).join("-"),
    download_url:f.download_url
  };
}

const sortFiles=l=>l.slice().sort((a,b)=>{
  if(a.grade!==b.grade) return b.grade-a.grade;
  if(a.num!==b.num) return b.num-a.num;
  return b.subject.localeCompare(a.subject);
});

/* ===== RENDER ===== */
const cardHTML=f=>`
<div class="card">
  <div class="top-badge">${f.grade}</div>
  <div class="card-top">
    <div class="file-icon">${extIcon(f.name)}</div>
    <div>
      <div class="name">${f.code}</div>
      <div class="sub">${f.desc||"(kh√¥ng m√¥ t·∫£)"}</div>
    </div>
  </div>
  <div class="card-actions">
    <button class="action-btn view-btn"
      onclick="location.href='vd/view.html?file=${encodeURIComponent(f.download_url)}'">
      üëÅ Xem
    </button>
    <a class="action-btn download-btn" href="${f.download_url}" download>‚¨á T·∫£i</a>
  </div>
</div>`;

const renderAll=l=>grid.innerHTML=l.map(cardHTML).join("");

const getRecent=s=>{
  const pick=g=>s.filter(x=>x.grade===g).slice(0,2);
  return [...pick("12"),...pick("11"),...pick("10")].slice(0,6);
};

const renderRecent=s=>recent.innerHTML=getRecent(s).map(cardHTML).join("");

/* ===== LOAD ===== */
async function load(){
  const r=await fetch(api);
  const d=await r.json();
  all=d.filter(x=>x.type==="file").map(parseFile);
  all.sorted=sortFiles(all);
  renderRecent(all.sorted);
  renderAll(all.sorted);
}

/* ===== FILTER ===== */
function setFilter(t,b){
  document.querySelectorAll(".filters .small").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  const s=all.sorted;
  if(t==="all") renderAll(s);
  else if(t==="recent") renderAll(getRecent(s));
  else if(t==="old"){
    const r=new Set(getRecent(s).map(x=>x.name));
    renderAll(s.filter(x=>!r.has(x.name)));
  }else renderAll(s.filter(x=>x.grade===t));
}

/* ===== SEARCH ===== */
q.oninput=e=>{
  const k=e.target.value.toLowerCase();
  renderAll(all.sorted.filter(f=>
    f.code.toLowerCase().includes(k) ||
    f.desc.toLowerCase().includes(k)
  ));
};

/* ===== IN-APP DETECT ===== */
function isInAppBrowser(){
  const ua=navigator.userAgent.toLowerCase();
  return ua.includes("fbav")||ua.includes("fban")||
         ua.includes("messenger")||ua.includes("zalo")||
         ua.includes("tiktok")||ua.includes("instagram");
}
function openInBrowser(){
  window.open(location.href,"_blank");
}
if(isInAppBrowser()){
  document.getElementById("inappWarning").style.display="block";
}

load();
</script>
</body>
</html>
