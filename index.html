<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<link rel="icon" href="avatar.png">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ch·ªën H·ªçc T·∫≠p ‚Äî KienDev_</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#020617;
    --neon1:#7C3AED;
    --neon2:#06B6D4;
    --muted:#95a5c7;
    --pink1:#ffb86b;
    --pink2:#ff6bcb;
    --card:#0b0f1a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Poppins",sans-serif;background:#030516;color:#e7f0ff;}
  .wrap{max-width:1200px;margin:auto;padding:20px;}
  .top{display:flex;flex-wrap:wrap;align-items:center;gap:16px;padding:16px;border-radius:14px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);backdrop-filter:blur(6px);}
  .brand{display:flex;align-items:center;gap:14px;}
  .avatar{width:70px;height:70px;border-radius:14px;object-fit:cover}
  .title h1{margin:0;font-size:20px;color:white;font-weight:600;}
  .title p{margin:3px 0 0;color:var(--muted);font-size:13px}
  .controls{display:flex;gap:10px;margin-left:auto;flex-wrap:wrap;align-items:center;}
  .search{padding:11px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.08);color:white;width:240px;}
  button.small{padding:10px 14px;border-radius:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);color:white;cursor:pointer;}
  .btn-primary{padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:white;border:0;cursor:pointer;font-weight:700;}
  .section-row{margin-top:18px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .pill{padding:8px 14px;border-radius:999px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);cursor:pointer;font-weight:700;color:var(--muted)}
  .pill.active{background:linear-gradient(90deg,var(--neon1),var(--neon2));color:white;box-shadow:0 6px 18px rgba(124,58,237,0.14);border:0}
  .grid{margin-top:22px;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;}
  .card{padding:16px;border-radius:14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);transition:transform .18s ease, box-shadow .18s ease;position:relative;}
  .card:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,0,0,0.25);}
  .card-top{display:flex;gap:12px;align-items:center;}
  .file-icon{width:52px;height:52px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:26px;background:rgba(255,255,255,0.04);}
  .name{font-weight:700;font-size:15px;}
  .sub{font-size:12px;color:var(--muted);margin-top:5px}
  .card-actions{display:flex;gap:10px;margin-top:14px;}
  .action-btn{flex:1;padding:10px 12px;border-radius:10px;font-weight:700;border:0;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;}
  .view-btn{background:linear-gradient(90deg,#0ea5e9,#7c3aed);color:white;}
  .download-btn{background:linear-gradient(90deg,var(--pink1),var(--pink2));color:#071023;text-decoration:none;}
  .top-badge{position:absolute;left:14px;top:14px;padding:4px 8px;font-size:11px;font-weight:700;background:linear-gradient(90deg,#ffb86b,#ff6bcb);border-radius:6px;color:#071023;}
  .controls-extended{display:flex;gap:8px;align-items:center;margin-top:10px;width:100%;}
  .meta-row{margin-top:12px;color:var(--muted);font-size:13px;display:flex;gap:8px;align-items:center;justify-content:space-between;}

  /* Recent rows */
  .recent-wrap{margin-top:18px;display:block}
  .recent-row{margin-top:18px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);}
  .row-head{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .row-title{font-weight:700}
  .row-track-wrap{position:relative;margin-top:12px;overflow:hidden}
  .recent-track{display:flex;gap:12px;transition:transform .38s cubic-bezier(.2,.9,.2,1);will-change:transform}
  .recent-item{min-width:260px;max-width:260px;background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);box-shadow: 0 6px 18px rgba(2,6,23,0.4);opacity:0;transform:translateY(18px);animation: itemIn .45s ease forwards;}
  @keyframes itemIn { from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:translateY(0)} }
  .row-controls{display:flex;gap:8px;align-items:center}
  .nav-btn{width:44px;height:36px;border-radius:10px;border:0;cursor:pointer;font-weight:700;background:linear-gradient(90deg,#111428,#0e1530);color:white;box-shadow:0 6px 18px rgba(2,6,23,0.7);display:flex;align-items:center;justify-content:center;}
  .nav-btn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(2,6,23,0.8)}
  .paging{display:flex;gap:10px;}
  .page-btn{padding:8px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;background:linear-gradient(90deg, #f6f1ff, #e6f6ff);color:#071023;box-shadow: 0 6px 18px rgba(124,58,237,0.08);transition:transform .12s ease;}
  .page-btn:hover{transform:translateY(-2px)}
  @media (max-width:900px){ .recent-item{min-width:220px;max-width:220px} }
  @media (max-width:600px){ .controls{margin-left:0;width:100%;justify-content:space-between;} .search{flex:1} .controls-extended{flex-direction:column;align-items:stretch} .recent-item{min-width:180px;max-width:220px} .page-btn{padding:8px 10px} }
</style>
</head>
<body>

<div class="wrap">

  <div class="top">
    <div class="brand">
      <img src="avatar.png" class="avatar">
      <div class="title">
        <h1>CH·ªêN H·ªåC T·∫¨P</h1>
        <p>Code by KienDev ‚Äî Xem & T·∫£i t√†i li·ªáu</p>
        <p style="color:var(--muted);font-size:12px">T√¨m theo m√£: (l·ªõp)-(s·ªë)-(m√¥n)</p>
      </div>
    </div>

    <div class="controls">
      <input id="q" class="search" placeholder="T√¨m m√£ ƒë·ªÅ...">
      <button id="refresh" class="small">‚ü≥</button>
      <button id="new" class="btn-primary">L√†m m·ªõi</button>
    </div>
  </div>

  <!-- M·ª•c -->
  <div class="section-row" id="categories">
    <div class="pill active" data-cat="all">T·∫•t c·∫£ file</div>
    <div class="pill" data-cat="recent">M·ªõi nh·∫•t</div>
    <div class="pill" data-cat="10">L·ªõp 10</div>
    <div class="pill" data-cat="11">L·ªõp 11</div>
    <div class="pill" data-cat="12">L·ªõp 12</div>
  </div>

  <!-- RECENT (lu√¥n hi·ªán ·ªü tr√™n) -->
  <div class="recent-wrap" id="recentWrap">
    <div id="recent12" class="recent-row">
      <div class="row-head">
        <div class="row-title">L·ªõp 12</div>
        <div class="row-controls">
          <button class="nav-btn" data-class="12" data-dir="prev">‚óÄ</button>
          <button class="nav-btn" data-class="12" data-dir="next">‚ñ∂</button>
        </div>
      </div>
      <div class="row-track-wrap"><div class="recent-track" data-class="12"></div></div>
    </div>

    <div id="recent11" class="recent-row">
      <div class="row-head">
        <div class="row-title">L·ªõp 11</div>
        <div class="row-controls">
          <button class="nav-btn" data-class="11" data-dir="prev">‚óÄ</button>
          <button class="nav-btn" data-class="11" data-dir="next">‚ñ∂</button>
        </div>
      </div>
      <div class="row-track-wrap"><div class="recent-track" data-class="11"></div></div>
    </div>

    <div id="recent10" class="recent-row">
      <div class="row-head">
        <div class="row-title">L·ªõp 10</div>
        <div class="row-controls">
          <button class="nav-btn" data-class="10" data-dir="prev">‚óÄ</button>
          <button class="nav-btn" data-class="10" data-dir="next">‚ñ∂</button>
        </div>
      </div>
      <div class="row-track-wrap"><div class="recent-track" data-class="10"></div></div>
    </div>
  </div>

  <!-- Controls (pagination ƒë·∫πp) -->
  <div class="controls-extended">
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
      <div id="summary" style="color:var(--muted)">ƒêang t·∫£i...</div>
      <div class="paging">
        <button id="prevPage" class="page-btn">¬´ Tr∆∞·ªõc</button>
        <button id="nextPage" class="page-btn">Sau ¬ª</button>
      </div>
    </div>
  </div>

  <!-- Grid ch√≠nh (hi·ªÉn th·ªã theo m·ª•c) -->
  <div id="grid" class="grid"></div>

</div>

<script>
const owner="kientrng";
const repo="pages";
const folder="files";
const api=`https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;

function extIcon(name){
  const e=name.split('.').pop().toLowerCase();
  if(/doc|docx/.test(e)) return "üìò";
  if(e==="pdf") return "üìï";
  if(/png|jpe?g|gif/.test(e)) return "üñºÔ∏è";
  if(/ppt|pptx/.test(e)) return "üìä";
  return "üìÑ";
}
function clean(n){ return n.replace(/\.(docx?|pdf|png|jpe?g|pptx?)$/i,""); }
function parseFileName(n){
  const base = clean(n);
  const parts = base.split("-");
  let cls = parts[0] || "";
  let num = parts[1] || "";
  const clsNum = parseInt(cls,10) || 0;
  const numNum = parseInt(num,10) || 0;
  const subject = parts.slice(2).join("-") || parts.slice(1).join("-");
  return {cls: cls, clsNum, num: num, numNum: numNum, subject, title: subject || base};
}

const grid=document.getElementById("grid");
const qInput = document.getElementById("q");
const summary = document.getElementById("summary");
const categories = document.getElementById("categories");
const recentWrap = document.getElementById("recentWrap");

let all=[]; let currentPage = 1; const pageSize = 12;
const offsets = { '12':0, '11':0, '10':0 };

async function load(){
  grid.innerHTML="ƒêang t·∫£i...";
  currentPage = 1;
  try{
    const r=await fetch(api);
    if(!r.ok) throw new Error("Kh√¥ng l·∫•y ƒë∆∞·ª£c danh s√°ch file");
    const d=await r.json();
    all=d.filter(f=>f.type==="file").map(f=> ({...f, parsed: parseFileName(f.name)}));
    buildRecentRows(); renderPage(1);
  }catch(err){
    grid.innerHTML="L·ªói t·∫£i d·ªØ li·ªáu."; console.error(err);
  }
}

// Build recent rows contents (all files for each class sorted desc by num)
function buildRecentRows(){
  ['12','11','10'].forEach(cls=>{
    const track = document.querySelector('.recent-track[data-class="'+cls+'"]');
    track.innerHTML = '';
    const items = all.filter(f => String(f.parsed.cls) === cls)
      .sort((a,b)=>{
        if(b.parsed.clsNum !== a.parsed.clsNum) return b.parsed.clsNum - a.parsed.clsNum;
        if(b.parsed.numNum !== a.parsed.numNum) return b.parsed.numNum - a.parsed.numNum;
        return b.name.localeCompare(a.name);
      });
    if(items.length === 0){
      const ph = document.createElement('div'); ph.className='recent-item';
      ph.innerHTML = `<div style="color:var(--muted)">Kh√¥ng c√≥ file cho l·ªõp ${cls}.</div>`;
      track.appendChild(ph); return;
    }
    items.forEach(f=>{
      const n=f.name, title=f.parsed.title, raw=f.download_url;
      const el = document.createElement('div'); el.className='recent-item';
      el.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center">
          <div style="width:46px;height:46px;border-radius:10px;background:rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center">${extIcon(n)}</div>
          <div>
            <div style="font-weight:700">${cls}-${f.parsed.num}-${title}</div>
            <div style="color:var(--muted);font-size:13px;margin-top:6px">${n}</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="action-btn view-btn" style="flex:1" onclick="openView('${encodeURIComponent(raw)}','${encodeURIComponent(n)}')">üëÅ Xem</button>
          <a class="action-btn download-btn" style="flex:1;display:flex;align-items:center;justify-content:center" href="${raw}" download>‚¨á T·∫£i</a>
        </div>
      `;
      track.appendChild(el);
    });
    offsets[cls] = 0; track.style.transform = 'translateX(0)';
  });
}

// nav for recent rows
document.addEventListener('click', (ev)=>{
  const btn = ev.target.closest('.nav-btn');
  if(!btn) return;
  const cls = btn.dataset.class; const dir = btn.dataset.dir;
  const track = document.querySelector('.recent-track[data-class="'+cls+'"]');
  if(!track) return;
  const item = track.children[0]; if(!item) return;
  const containerWidth = track.parentElement.getBoundingClientRect().width;
  const itemW = item.getBoundingClientRect().width + 12;
  const visible = Math.max(1, Math.floor(containerWidth / itemW));
  const maxOffset = Math.max(0, track.children.length - visible);
  if(dir === 'next') offsets[cls] = Math.min(maxOffset, offsets[cls] + 1);
  else offsets[cls] = Math.max(0, offsets[cls] - 1);
  track.style.transform = `translateX(${-(offsets[cls] * itemW)}px)`;
});

// categories click: change grid content (recent always visible)
categories.addEventListener('click', (ev)=>{
  const pill = ev.target.closest('.pill'); if(!pill) return;
  Array.from(categories.querySelectorAll('.pill')).forEach(p=>p.classList.remove('active'));
  pill.classList.add('active');
  const cat = pill.dataset.cat;
  if(cat === 'recent'){
    // grid also show recent ordering (descending by cls-num-subject)
    renderPage(1, true);
  } else {
    renderPage(1, false, cat);
  }
});

// apply filter & sorting for grid; if recentFlag true -> sort desc cls-num-name
function applyFilters(list, recentFlag=false, cat=null){
  const k = qInput.value.trim().toLowerCase();
  let res = list.filter(f => f.name.toLowerCase().includes(k));
  if(cat === '10' || cat === '11' || cat === '12'){
    res = res.filter(f => String(f.parsed.cls) === cat);
  }
  if(recentFlag){
    res.sort((a,b)=>{
      if(b.parsed.clsNum !== a.parsed.clsNum) return b.parsed.clsNum - a.parsed.clsNum;
      if(b.parsed.numNum !== a.parsed.numNum) return b.parsed.numNum - a.parsed.numNum;
      return b.name.localeCompare(a.name);
    });
  } else {
    res.sort((a,b)=> a.name.localeCompare(b.name));
  }
  return res;
}

function renderPage(page, recentFlag=false, cat=null){
  const filtered = applyFilters(all, recentFlag, cat);
  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  if(page < 1) page = 1;
  if(page > totalPages) page = totalPages;
  currentPage = page; const start = (page-1)*pageSize; const end = start + pageSize;
  const pageItems = filtered.slice(start,end);
  renderGrid(pageItems);
  summary.innerText = `Hi·ªÉn th·ªã ${start+1}-${Math.min(end,total)} / ${total} file ‚Ä¢ Trang ${currentPage}/${totalPages}`;
}

function renderGrid(list){
  if(!list.length){grid.innerHTML="<div style='padding:20px;color:var(--muted)'>Kh√¥ng c√≥ file.</div>";return;}
  grid.innerHTML="";
  list.forEach(f=>{
    const n=f.name; const s=f.parsed; const badge=s.cls; const title = s.title; const raw=f.download_url;
    const el=document.createElement("div"); el.className="card";
    el.innerHTML=`
      <div class="top-badge">${badge}</div>
      <div class="card-top">
        <div class="file-icon">${extIcon(n)}</div>
        <div>
          <div class="name">${badge}-${s.num}-${title}</div>
          <div class="sub">${n}</div>
          <div style="color:var(--muted);font-size:12px;margin-top:6px">K√≠ch th∆∞·ªõc: ${formatSize(f.size)}</div>
        </div>
      </div>
      <div class="card-actions">
        <button class="action-btn view-btn" onclick="openView('${encodeURIComponent(raw)}','${encodeURIComponent(n)}')">üëÅ Xem</button>
        <a class="action-btn download-btn" href="${raw}" download>‚¨á T·∫£i</a>
      </div>
    `;
    grid.appendChild(el);
  });
}

function formatSize(bytes){
  if(bytes < 1024) return bytes + " B";
  if(bytes < 1024*1024) return (bytes/1024).toFixed(1) + " KB";
  return (bytes/(1024*1024)).toFixed(2) + " MB";
}

// Open view.html (original behavior) ‚Äî not modal
function openView(rawEnc, nameEnc){
  const raw = decodeURIComponent(rawEnc);
  const name = decodeURIComponent(nameEnc);
  location.href = `view.html?file=${encodeURIComponent(raw)}&name=${encodeURIComponent(name)}`;
}

// prev/next page
document.getElementById("prevPage").onclick = ()=> {
  const pill = categories.querySelector('.pill.active');
  const cat = pill ? pill.dataset.cat : 'all';
  if(cat === 'recent') renderPage(currentPage-1, true);
  else renderPage(currentPage-1, false, (cat==='all'?null:cat));
};
document.getElementById("nextPage").onclick = ()=> {
  const pill = categories.querySelector('.pill.active');
  const cat = pill ? pill.dataset.cat : 'all';
  if(cat === 'recent') renderPage(currentPage+1, true);
  else renderPage(currentPage+1, false, (cat==='all'?null:cat));
};

// search updates both recent (rebuild) and grid
document.getElementById("q").oninput = ()=> { buildRecentRows(); const pill = categories.querySelector('.pill.active'); const cat = pill ? pill.dataset.cat : 'all'; if(cat === 'recent') renderPage(1, true); else renderPage(1, false, (cat==='all'?null:cat)); };

document.getElementById("refresh").onclick = load;
document.getElementById("new").onclick = load;

load();
</script>

</body>
</html>
