<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<link rel="icon" href="avatar.png">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ch·ªën H·ªçc T·∫≠p ‚Äî KienDev_</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#020617;
    --neon1:#7C3AED;
    --neon2:#06B6D4;
    --muted:#95a5c7;
    --pink1:#ffb86b;
    --pink2:#ff6bcb;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Poppins",sans-serif;
    background:#030516;
    color:#e7f0ff;
  }

  .wrap{max-width:1200px;margin:auto;padding:20px;}

  .top{
    display:flex;flex-wrap:wrap;align-items:center;gap:16px;
    padding:16px;border-radius:14px;
    background:rgba(255,255,255,0.02);
    border:1px solid rgba(255,255,255,0.05);
    backdrop-filter:blur(6px);
  }
  .brand{display:flex;align-items:center;gap:14px;}
  .avatar{width:70px;height:70px;border-radius:14px;object-fit:cover}

  .title h1{
    margin:0;
    font-family:"Poppins",sans-serif;
    font-size:20px;
    color:white;
    font-weight:600;
  }

  .title p{margin:3px 0 0;color:var(--muted);font-size:13px}

  .controls{
    display:flex;gap:10px;margin-left:auto;
    flex-wrap:wrap;align-items:center;
  }
  .search{
    padding:11px 14px;border-radius:10px;
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.08);
    color:white;
    width:240px;
  }
  button.small{
    padding:10px 14px;border-radius:10px;
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.08);
    color:white;cursor:pointer;
  }
  .btn-primary{
    padding:10px 14px;border-radius:10px;
    background:linear-gradient(90deg,var(--neon1),var(--neon2));
    color:white;border:0;cursor:pointer;font-weight:700;
  }

  .grid{
    margin-top:22px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
    gap:18px;
  }

  .card{
    padding:16px;border-radius:14px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.04);
    transition:0.2s;
    position:relative;
  }
  .card:hover{
    transform:translateY(-6px);
    box-shadow:0 10px 30px rgba(0,0,0,0.2);
  }

  .card-top{display:flex;gap:12px;align-items:center;}
  .file-icon{
    width:52px;height:52px;border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    font-size:26px;
    background:rgba(255,255,255,0.04);
  }

  .name{font-weight:700;font-size:15px;}
  .sub{font-size:12px;color:var(--muted);margin-top:5px}

  .card-actions{
    display:flex;gap:10px;margin-top:14px;
  }
  .action-btn{
    flex:1;padding:10px 12px;border-radius:10px;
    font-weight:700;border:0;cursor:pointer;
    display:flex;align-items:center;justify-content:center;
    gap:6px;
  }

  .view-btn{
    background:linear-gradient(90deg,#0ea5e9,#7c3aed);
    color:white;
  }
  .download-btn{
    background:linear-gradient(90deg,var(--pink1),var(--pink2));
    color:#071023;text-decoration:none;
  }

  .top-badge{
    position:absolute;left:14px;top:14px;
    padding:4px 8px;font-size:11px;font-weight:700;
    background:linear-gradient(90deg,#ffb86b,#ff6bcb);
    border-radius:6px;color:#071023;
  }

  .controls-extended{
    display:flex;gap:8px;align-items:center;margin-top:10px;
    width:100%;
  }
  select, .small-btn {
    padding:9px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.04);color:white;
  }

  .meta-row{margin-top:12px;color:var(--muted);font-size:13px;display:flex;gap:8px;align-items:center;justify-content:space-between;}

  /* modal */
  .modal {
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.6);z-index:9999;padding:20px;
  }
  .modal .box {
    width:100%;max-width:1100px;height:80vh;background:#071023;border-radius:12px;padding:12px;display:flex;flex-direction:column;
  }
  .modal iframe{flex:1;width:100%;border:0;border-radius:8px;background:white}
  .modal .modal-top{display:flex;gap:10px;align-items:center;margin-bottom:8px;}

  @media (max-width:600px){
    .controls{margin-left:0;width:100%;justify-content:space-between;}
    .search{flex:1}
    .controls-extended{flex-direction:column;align-items:stretch}
  }
</style>
</head>
<body>

<div id="inapp-warning" style="
  display:none;
  background:#fff3cd;
  color:#000;
  padding:16px;
  margin:12px;
  border-radius:10px;
  font-size:14px;
  border:1px solid #ffe299;
">
  ‚ö†Ô∏è <b>B·∫°n ƒëang m·ªü trang n√†y trong ·ª©ng d·ª•ng (TikTok, Messenger, Zalo...)</b><br>
  C√°c ·ª©ng d·ª•ng n√†y <b>kh√¥ng cho t·∫£i file</b>.<br><br>
  ‚û§ Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ m·ªü b·∫±ng tr√¨nh duy·ªát th·∫≠t:
  <br><br>
  <button onclick="openExternalBrowser()" style="
    padding:10px 16px;
    background:#0ea5e9;
    color:white;
    border:0;
    border-radius:8px;
    cursor:pointer;
    font-weight:700;
  ">
    üåê M·ªü b·∫±ng Chrome / C·ªëc C·ªëc
  </button>
</div>


<div class="wrap">

  <div class="top">
    <div class="brand">
      <img src="avatar.png" class="avatar">
      <div class="title">
        <h1>CH·ªêN H·ªåC T·∫¨P</h1>
        <p>Code by KienDev ‚Äî Xem & T·∫£i t√†i li·ªáu</p>
        <p style="color:var(--muted);font-size:12px">T√¨m ki·∫øm m√£ ƒë·ªÅ theo l·ªõp: (l·ªõp)-(s·ªë th·ª© t·ª±)-(m√¥n)</p>
      </div>
    </div>

    <div class="controls">
      <input id="q" class="search" placeholder="T√¨m m√£ ƒë·ªÅ...">
      <button id="refresh" class="small">‚ü≥</button>
      <button id="new" class="btn-primary">L√†m m·ªõi</button>
    </div>
  </div>

  <div class="controls-extended">
    <div style="display:flex;gap:8px;align-items:center;">
      <label style="color:var(--muted);font-size:13px">L·ªçc l·ªõp:</label>
      <select id="classFilter"><option value="">T·∫•t c·∫£</option></select>
    </div>

    <div style="display:flex;gap:8px;align-items:center;">
      <label style="color:var(--muted);font-size:13px">S·∫Øp x·∫øp:</label>
      <select id="sortBy">
        <option value="name-asc">T√™n A‚ÜíZ</option>
        <option value="name-desc">T√™n Z‚ÜíA</option>
        <option value="size-desc">K√≠ch th∆∞·ªõc l·ªõn‚Üính·ªè</option>
        <option value="size-asc">K√≠ch th∆∞·ªõc nh·ªè‚Üíl·ªõn</option>
      </select>
    </div>

    <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
      <div id="summary" style="color:var(--muted)">ƒêang t·∫£i...</div>
      <div style="display:flex;gap:6px;align-items:center">
        <button id="prevPage" class="small-btn">¬´ Tr∆∞·ªõc</button>
        <button id="nextPage" class="small-btn">Sau ¬ª</button>
      </div>
    </div>
  </div>

  <div id="grid" class="grid"></div>

</div>

<!-- Modal preview -->
<div id="previewModal" class="modal" onclick="closeModal(event)">
  <div class="box" onclick="event.stopPropagation()">
    <div class="modal-top">
      <button onclick="closeModal()" class="small" style="background:rgba(255,255,255,0.03);color:white;border:0;border-radius:8px">‚úï ƒê√≥ng</button>
      <div id="modalTitle" style="font-weight:700;color:white;margin-left:8px"></div>
      <div style="flex:1"></div>
      <a id="modalDownload" class="btn-primary" style="text-decoration:none;padding:10px 12px;border-radius:8px">‚¨á T·∫£i</a>
    </div>
    <iframe id="modalFrame" src=""></iframe>
  </div>
</div>

<script>
const owner="kientrng";
const repo="pages";
const folder="files";
const api=`https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;

function extIcon(name){
  const e=name.split('.').pop().toLowerCase();
  if(/doc|docx/.test(e)) return "üìò";
  if(e==="pdf") return "üìï";
  if(/png|jpe?g|gif/.test(e)) return "üñºÔ∏è";
  if(/ppt|pptx/.test(e)) return "üìä";
  return "üìÑ";
}
function clean(n){
  return n.replace(/\.(docx?|pdf|png|jpe?g|pptx?)$/i,"");
}

const grid=document.getElementById("grid");
const classFilter = document.getElementById("classFilter");
const sortBy = document.getElementById("sortBy");
const qInput = document.getElementById("q");
const summary = document.getElementById("summary");

let all=[];

// pagination
let currentPage = 1;
const pageSize = 12;

async function load(){
  grid.innerHTML="ƒêang t·∫£i...";
  currentPage = 1;
  try{
    const r=await fetch(api);
    if(!r.ok) throw new Error("Kh√¥ng l·∫•y ƒë∆∞·ª£c danh s√°ch file");
    const d=await r.json();
    all=d.filter(f=>f.type==="file");
    populateFilter();
    renderPage(currentPage);
  }catch(err){
    grid.innerHTML="L·ªói t·∫£i d·ªØ li·ªáu.";
    console.error(err);
  }
}

function populateFilter(){
  const badges = new Set();
  all.forEach(f=>{
    const s=clean(f.name);
    const badge = s.split("-")[0] || "";
    if(badge) badges.add(badge);
  });
  // clear existing options except "T·∫•t c·∫£"
  classFilter.innerHTML = '<option value="">T·∫•t c·∫£</option>';
  Array.from(badges).sort((a,b)=>a.localeCompare(b)).forEach(b=>{
    const opt = document.createElement("option");
    opt.value = b; opt.innerText=b;
    classFilter.appendChild(opt);
  });
}

function applyFilters(list){
  const k = qInput.value.trim().toLowerCase();
  let res = list.filter(f => f.name.toLowerCase().includes(k));
  const cls = classFilter.value;
  if(cls) res = res.filter(f => {
    const badge = clean(f.name).split("-")[0] || "";
    return badge === cls;
  });

  // sort
  const s = sortBy.value;
  if(s.startsWith("name")){
    res.sort((a,b)=>{
      const na = clean(a.name).toLowerCase();
      const nb = clean(b.name).toLowerCase();
      return s.endsWith("asc") ? na.localeCompare(nb) : nb.localeCompare(na);
    });
  } else if(s.startsWith("size")){
    res.sort((a,b)=> s.endsWith("asc") ? a.size - b.size : b.size - a.size);
  }

  return res;
}

function renderPage(page){
  const filtered = applyFilters(all);
  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  if(page < 1) page = 1;
  if(page > totalPages) page = totalPages;
  currentPage = page;
  const start = (page-1)*pageSize;
  const end = start + pageSize;
  const pageItems = filtered.slice(start,end);
  render(pageItems);

  summary.innerText = `Hi·ªÉn th·ªã ${start+1}-${Math.min(end,total)} / ${total} file ‚Ä¢ Trang ${currentPage}/${totalPages}`;
}

function render(list){
  if(!list.length){grid.innerHTML="<div style='padding:20px;color:var(--muted)'>Kh√¥ng c√≥ file.</div>";return;}
  grid.innerHTML="";
  list.forEach(f=>{
    const n=f.name;
    const s=clean(n);
    const badge=s.split("-")[0];
    const title = s.split("-").slice(1).join("-") || s.split("-").pop();
    const raw=f.download_url;

    const el=document.createElement("div");
    el.className="card";
    el.innerHTML=`
      <div class="top-badge">${badge}</div>
      <div class="card-top">
        <div class="file-icon">${extIcon(n)}</div>
        <div>
          <div class="name">${title}</div>
          <div class="sub">${n}</div>
          <div style="color:var(--muted);font-size:12px;margin-top:6px">K√≠ch th∆∞·ªõc: ${formatSize(f.size)}</div>
        </div>
      </div>

      <div class="card-actions">
        <button class="action-btn view-btn" onclick="openPreview('${encodeURIComponent(raw)}','${encodeURIComponent(n)}')">
          üëÅ Xem
        </button>

        <a class="action-btn download-btn" href="${raw}" download>
          ‚¨á T·∫£i
        </a>
      </div>
    `;
    grid.appendChild(el);
  });
}

function formatSize(bytes){
  if(bytes < 1024) return bytes + " B";
  if(bytes < 1024*1024) return (bytes/1024).toFixed(1) + " KB";
  return (bytes/(1024*1024)).toFixed(2) + " MB";
}

function openPreview(rawEnc, nameEnc){
  const raw = decodeURIComponent(rawEnc);
  const name = decodeURIComponent(nameEnc);
  // set modal iframe src according to extension (reuse logic from view.html)
  const ext = name.split(".").pop().toLowerCase();
  const modalFrame = document.getElementById("modalFrame");
  const modalTitle = document.getElementById("modalTitle");
  const modalDownload = document.getElementById("modalDownload");

  modalTitle.innerText = name;
  modalDownload.href = raw;
  modalDownload.setAttribute("target","_blank");

  const officeURL = `https://view.officeapps.live.com/op/embed.aspx?src=${raw}`;
  if(/(doc|docx|ppt|pptx|xls|xlsx)$/i.test(ext)){
    modalFrame.src = officeURL;
  } else if(ext === "pdf"){
    modalFrame.src = raw;
  } else if(/png|jpe?g|gif|webp/.test(ext)){
    // show image in data url iframe fallback
    modalFrame.srcdoc = `<div style="display:flex;align-items:center;justify-content:center;height:100%;background:#071023"><img src="${raw}" style="max-width:100%;max-height:100%;border-radius:8px"></div>`;
    modalFrame.src = '';
  } else {
    modalFrame.src = raw;
  }

  document.getElementById("previewModal").style.display = "flex";
}

function closeModal(e){
  if(e) e.stopPropagation();
  const modal = document.getElementById("previewModal");
  modal.style.display = "none";
  const modalFrame = document.getElementById("modalFrame");
  modalFrame.src = "";
  modalFrame.srcdoc = "";
}

document.getElementById("q").oninput = ()=> renderPage(1);
classFilter.onchange = ()=> renderPage(1);
sortBy.onchange = ()=> renderPage(1);
document.getElementById("refresh").onclick = load;
document.getElementById("new").onclick = load;

// pagination buttons
document.getElementById("prevPage").onclick = ()=> renderPage(currentPage-1);
document.getElementById("nextPage").onclick = ()=> renderPage(currentPage+1);

// in-app browser warning
function isInAppBrowser() {
  const ua = navigator.userAgent || navigator.vendor || window.opera;
  return (
    ua.includes("FBAN") || ua.includes("FBAV") ||
    ua.includes("Instagram") ||
    ua.includes("Line") ||
    ua.includes("Zalo") || ua.includes("ZaloPC") ||
    ua.includes("TikTok") ||
    (ua.includes("wv") && ua.includes("Android"))
  );
}
if (isInAppBrowser()) {
  document.getElementById("inapp-warning").style.display = "block";
}
function openExternalBrowser() {
  const url = window.location.href;
  window.location.href =
    `intent://${url.replace("https://","")}` +
    "#Intent;scheme=https;package=com.android.chrome;end;";
}

load();
</script>

</body>
</html>
