<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ch·ªën H·ªçc T·∫≠p ‚Äî KienDev_</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#030516;
  --muted:#95a5c7;
  --accent1:#7C3AED;
  --accent2:#06B6D4;
  --pink1:#ffb86b;
  --pink2:#ff6bcb;
  --card:#081225;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box;font-family:"Poppins",sans-serif}
body{margin:0;background:var(--bg);color:#eaf2ff}
.wrap{max-width:1200px;margin:18px auto;padding:18px}

/* header */
.top{display:flex;align-items:center;gap:14px;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.04)}
.avatar{width:64px;height:64px;border-radius:12px;object-fit:cover}
.title h1{margin:0;font-size:20px}
.title p{margin:4px 0 0;color:var(--muted);font-size:13px}

/* controls */
.controls{margin-left:auto;display:flex;gap:8px;align-items:center}
.search{padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.05);color:#eaf2ff}

/* pills / categories */
.section-row{margin-top:18px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.pill{padding:8px 14px;border-radius:999px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted);font-weight:700;transition:all .18s ease}
.pill.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 12px 28px rgba(124,58,237,0.12);transform:translateY(-2px)}

/* recent (6 cards track) */
.recent-wrap{margin-top:18px}
.recent-head{display:flex;align-items:center;justify-content:space-between}
.recent-head .hint{color:var(--muted);font-size:13px}
.recent-track-wrap{position:relative;margin-top:12px;overflow:hidden;padding:6px 0}
.recent-track{display:flex;gap:12px;transition:transform .42s cubic-bezier(.22,.9,.3,1);will-change:transform}
.recent-card{
  min-width:300px;max-width:300px;background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);
  box-shadow:0 8px 28px rgba(2,6,23,0.5);
  transform:translateY(0);
}
.recent-top{display:flex;gap:12px;align-items:center}
.recent-name{font-weight:700}
.recent-sub{color:var(--muted);font-size:13px;margin-top:8px}

/* nav arrows - custom & animated */
.recent-nav{display:flex;gap:8px;align-items:center}
.arrow-btn{
  width:46px;height:40px;border-radius:10px;border:0;cursor:pointer;
  background:linear-gradient(180deg,#0f1630,#071025);color:white;
  box-shadow:0 10px 30px rgba(2,6,23,0.6);display:inline-flex;align-items:center;justify-content:center;font-weight:800;
  transition:transform .12s ease, box-shadow .18s ease;
}
.arrow-btn:hover{transform:translateY(-4px);box-shadow:0 18px 48px rgba(2,6,23,0.75)}
.arrow-btn:active{transform:translateY(-2px)}

/* grid area (cards by category) */
.grid{margin-top:22px;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
.card{padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border:1px solid rgba(255,255,255,0.04);transition:transform .18s ease, box-shadow .18s ease}
.card:hover{transform:translateY(-6px);box-shadow:0 14px 40px rgba(2,6,23,0.45)}
.top-badge{position:absolute;left:14px;top:14px;padding:6px 8px;border-radius:8px;background:linear-gradient(90deg,var(--pink1),var(--pink2));color:#071023;font-weight:800}

/* small button styles inside cards */
.card-actions{display:flex;gap:10px;margin-top:14px}
.btn-view{flex:1;padding:10px;border-radius:10px;border:0;background:linear-gradient(90deg,#0ea5e9,#7c3aed);color:white;cursor:pointer;font-weight:700}
.btn-dl{flex:1;padding:10px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--pink1),var(--pink2));color:#071023;cursor:pointer;font-weight:700;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}

/* pagination nicer */
.paging{display:flex;gap:10px;align-items:center;margin-top:14px;justify-content:flex-end}
.page-btn{padding:8px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;background:linear-gradient(90deg,#f6f1ff,#e6f6ff);color:#071023;box-shadow:0 8px 24px rgba(124,58,237,0.08);transition:transform .12s ease}
.page-btn:hover{transform:translateY(-3px)}

/* responsive tweaks */
@media(max-width:980px){ .recent-card{min-width:240px;max-width:240px} }
@media(max-width:640px){
  .recent-card{min-width:200px;max-width:200px}
  .search{width:140px}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <img src="avatar.png" class="avatar" alt="avatar">
    <div class="title">
      <h1>CH·ªêN H·ªåC T·∫¨P</h1>
      <p>Code by KienDev ‚Äî Xem & T·∫£i t√†i li·ªáu</p>
    </div>

    <div class="controls">
      <input id="q" class="search" placeholder="T√¨m m√£ ƒë·ªÅ (t√πy ch·ªçn)">
    </div>
  </div>

  <!-- 1) categories -->
  <div class="section-row" id="categories">
    <div class="pill active" data-cat="all">T·∫•t c·∫£</div>
    <div class="pill" data-cat="recent">M·ªõi nh·∫•t</div>
    <div class="pill" data-cat="10">L·ªõp 10</div>
    <div class="pill" data-cat="11">L·ªõp 11</div>
    <div class="pill" data-cat="12">L·ªõp 12</div>
  </div>

  <!-- 2) recent: 6 cards (2 per class 12,11,10) with nav -->
  <div class="recent-wrap" id="recentWrap">
    <div class="recent-head">
      <div>
        <div style="font-weight:800">File g·∫ßn ƒë√¢y</div>
        <div class="hint">6 file m·ªõi up ‚Äî s·∫Øp x·∫øp (l·ªõp)-(s·ªë)-(m√¥n) t·ª´ l·ªõn ‚Üí b√©, 2 file cho m·ªói l·ªõp</div>
      </div>
      <div class="recent-nav">
        <button class="arrow-btn" id="recentPrev">‚óÄ</button>
        <button class="arrow-btn" id="recentNext">‚ñ∂</button>
      </div>
    </div>

    <div class="recent-track-wrap">
      <div id="recentTrack" class="recent-track"></div>
    </div>
  </div>

  <!-- 3) grid of cards by category -->
  <div id="grid" class="grid"></div>

  <!-- paging -->
  <div class="paging">
    <div id="summary" style="color:var(--muted)">ƒêang t·∫£i...</div>
    <button id="prevPage" class="page-btn">¬´ Tr∆∞·ªõc</button>
    <button id="nextPage" class="page-btn">Sau ¬ª</button>
  </div>
</div>

<script>
/* CONFIG */
const owner = "kientrng", repo = "pages", folder = "files";
const api = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;

/* HELPERS */
const el = id => document.getElementById(id);
const extIcon = (name)=>{
  const e = name.split('.').pop().toLowerCase();
  if(/doc|docx/.test(e)) return "üìò";
  if(e==="pdf") return "üìï";
  if(/png|jpe?g|gif/.test(e)) return "üñºÔ∏è";
  if(/ppt|pptx/.test(e)) return "üìä";
  return "üìÑ";
};
const clean = s => s.replace(/\.(docx?|pdf|png|jpe?g|pptx?)$/i,"");
function parseName(n){
  const base = clean(n);
  const parts = base.split("-");
  const cls = parts[0] || "";
  const num = parts[1] || "";
  const clsNum = parseInt(cls,10) || 0;
  const numNum = parseInt(num,10) || 0;
  const subject = parts.slice(2).join("-") || parts.slice(1).join("-");
  return {cls, clsNum, num, numNum, subject, title: subject || base};
}

/* STATE */
let allFiles = []; // objects from GitHub API + parsed
let currentCategory = 'all';
let currentPage = 1;
const pageSize = 12;

/* UI elements */
const categories = document.getElementById('categories');
const recentTrack = document.getElementById('recentTrack');
const recentPrev = document.getElementById('recentPrev');
const recentNext = document.getElementById('recentNext');

/* Load files from GitHub contents endpoint */
async function loadFiles(){
  try{
    const r = await fetch(api);
    if(!r.ok) throw new Error("L·ªói API");
    const data = await r.json();
    allFiles = data.filter(f=>f.type==="file").map(f=> ({...f, parsed: parseName(f.name)}));
    buildRecent(); renderGridByCategory(); updateSummary();
  }catch(e){
    console.error(e);
    el('grid').innerHTML = `<div style="padding:20px;color:var(--muted)">Kh√¥ng t·∫£i ƒë∆∞·ª£c file.</div>`;
  }
}

/* 2) Build recentTrack exactly 6 cards: 2 from 12, 2 from 11, 2 from 10 in that order (desc) */
function buildRecent(){
  // helper: get top N for class sorted desc by clsNum,numNum,name
  function topForClass(cls, n){
    return allFiles.filter(f=>String(f.parsed.cls)===String(cls))
      .sort((a,b)=>{
        if(b.parsed.clsNum !== a.parsed.clsNum) return b.parsed.clsNum - a.parsed.clsNum;
        if(b.parsed.numNum !== a.parsed.numNum) return b.parsed.numNum - a.parsed.numNum;
        return b.name.localeCompare(a.name);
      })
      .slice(0,n);
  }
  const want = [];
  want.push(...topForClass(12,2));
  want.push(...topForClass(11,2));
  want.push(...topForClass(10,2));
  // if less than 6, fill with others following same ordering
  if(want.length < 6){
    const extras = allFiles.filter(f => !want.includes(f))
      .sort((a,b)=>{
        if(b.parsed.clsNum !== a.parsed.clsNum) return b.parsed.clsNum - a.parsed.clsNum;
        if(b.parsed.numNum !== a.parsed.numNum) return b.parsed.numNum - a.parsed.numNum;
        return b.name.localeCompare(a.name);
      }).slice(0, 6 - want.length);
    want.push(...extras);
  }
  // limit 6
  const recent = want.slice(0,6);
  // render
  recentTrack.innerHTML = "";
  recent.forEach(f=>{
    const n = f.name; const p = f.parsed;
    const card = document.createElement('div'); card.className = 'recent-card';
    card.innerHTML = `
      <div class="recent-top">
        <div style="width:48px;height:48px;border-radius:10px;background:rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center">${extIcon(n)}</div>
        <div>
          <div class="recent-name">${p.cls}-${p.num}-${p.title}</div>
          <div class="recent-sub">${n}</div>
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn-view" onclick="openView('${encodeURIComponent(f.download_url)}','${encodeURIComponent(f.name)}')">üëÅ Xem</button>
        <a class="btn-dl" href="${f.download_url}" download>‚¨á T·∫£i</a>
      </div>
    `;
    recentTrack.appendChild(card);
  });
  // reset position
  recentTrack.style.transform = 'translateX(0)';
}

/* recent nav: scroll by 2 cards (to show different groups) */
let recentIndex = 0;
function recentScroll(dir){
  const cards = recentTrack.children;
  if(!cards || cards.length===0) return;
  const cardW = cards[0].getBoundingClientRect().width + 12;
  const visible = Math.max(1, Math.floor((recentTrack.parentElement.clientWidth) / cardW));
  const maxIndex = Math.max(0, cards.length - visible);
  if(dir === 'next') recentIndex = Math.min(maxIndex, recentIndex + 1);
  else recentIndex = Math.max(0, recentIndex - 1);
  recentTrack.style.transform = `translateX(${-(recentIndex * cardW)}px)`;
}

/* 3) Grid rendering by category (all / recent / class 10/11/12)
   - 'recent' for grid sorts allFiles descending by cls-num-name (so newest first)
   - class filters by class
   - 'all' sorts by name asc (stable)
*/
function applyCategory(files, cat){
  if(!cat || cat === 'all'){
    return files.slice().sort((a,b)=> a.name.localeCompare(b.name));
  }
  if(cat === 'recent'){
    return files.slice().sort((a,b)=>{
      if(b.parsed.clsNum !== a.parsed.clsNum) return b.parsed.clsNum - a.parsed.clsNum;
      if(b.parsed.numNum !== a.parsed.numNum) return b.parsed.numNum - a.parsed.numNum;
      return b.name.localeCompare(a.name);
    });
  }
  // class filter 10/11/12
  return files.filter(f=> String(f.parsed.cls) === String(cat))
    .sort((a,b)=>{
      if(b.parsed.clsNum !== a.parsed.clsNum) return b.parsed.clsNum - a.parsed.clsNum;
      if(b.parsed.numNum !== a.parsed.numNum) return b.parsed.numNum - a.parsed.numNum;
      return b.name.localeCompare(a.name);
    });
}

function renderGridByCategory(page=1){
  const catPill = categories.querySelector('.pill.active');
  const cat = catPill ? catPill.dataset.cat : 'all';
  const filtered = applyCategory(allFiles, cat);
  const q = el('q').value.trim().toLowerCase();
  const searchFiltered = q ? filtered.filter(f=> f.name.toLowerCase().includes(q)) : filtered;
  const total = searchFiltered.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  if(page < 1) page = 1; if(page > totalPages) page = totalPages;
  currentPage = page;
  const start = (page-1)*pageSize, end = start + pageSize;
  const pageItems = searchFiltered.slice(start, end);

  const grid = el('grid');
  if(!pageItems.length){
    grid.innerHTML = `<div style="padding:20px;color:var(--muted)">Kh√¥ng c√≥ file.</div>`;
  } else {
    grid.innerHTML = "";
    pageItems.forEach(f=>{
      const n=f.name, p=f.parsed;
      const div = document.createElement('div'); div.className = 'card';
      div.style.position = 'relative';
      div.innerHTML = `
        <div class="top-badge">${p.cls}</div>
        <div style="display:flex;gap:12px;align-items:center">
          <div style="width:48px;height:48px;border-radius:10px;background:rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center">${extIcon(n)}</div>
          <div>
            <div style="font-weight:800">${p.cls}-${p.num}-${p.title}</div>
            <div style="color:var(--muted);font-size:13px;margin-top:6px">${n}</div>
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:12px" class="card-actions">
          <button class="btn-view" onclick="openView('${encodeURIComponent(f.download_url)}','${encodeURIComponent(f.name)}')">üëÅ Xem</button>
          <a class="btn-dl" href="${f.download_url}" download>‚¨á T·∫£i</a>
        </div>
      `;
      grid.appendChild(div);
    });
  }
  el('summary').innerText = `Hi·ªÉn th·ªã ${Math.min(total, (page-1)*pageSize+1)} - ${Math.min(total, page*pageSize)} / ${total} file ‚Ä¢ Trang ${currentPage}/${totalPages}`;
}

/* open view (original behavior) */
function openView(rawEnc, nameEnc){
  const raw = decodeURIComponent(rawEnc);
  const name = decodeURIComponent(nameEnc);
  location.href = `view.html?file=${encodeURIComponent(raw)}&name=${encodeURIComponent(name)}`;
}

/* events */
categories.addEventListener('click', (ev)=>{
  const pill = ev.target.closest('.pill');
  if(!pill) return;
  categories.querySelectorAll('.pill').forEach(p=>p.classList.remove('active'));
  pill.classList.add('active');
  currentCategory = pill.dataset.cat;
  // when switching category, grid updates. recent always visible above.
  renderGridByCategory(1);
});

/* recent nav */
recentPrev.addEventListener('click', ()=> recentScroll('prev'));
recentNext.addEventListener('click', ()=> recentScroll('next'));

/* paging */
el('prevPage').addEventListener('click', ()=> renderGridByCategory(currentPage-1));
el('nextPage').addEventListener('click', ()=> renderGridByCategory(currentPage+1));

/* search updates both recent build (to filter) and grid */
el('q').addEventListener('input', ()=>{
  buildRecent();
  renderGridByCategory(1);
});

/* initial load */
loadFiles();

/* resize: reset recent index */
window.addEventListener('resize', ()=> { recentIndex = 0; recentTrack.style.transform = 'translateX(0)'; });
</script>
</body>
</html>
